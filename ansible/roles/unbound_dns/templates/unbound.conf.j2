# Unbound configuration file for {{ ansible_hostname }}
# Generated by Ansible

server:
    # Network interfaces
    {% for interface in unbound_interfaces %}
    interface: {{ interface }}
    {% endfor %}
    port: {{ unbound_port }}
    
    # Protocol support
    do-ip4: {{ 'yes' if unbound_do_ip4 else 'no' }}
    do-ip6: {{ 'yes' if unbound_do_ip6 else 'no' }}
    do-udp: {{ 'yes' if unbound_do_udp else 'no' }}
    do-tcp: {{ 'yes' if unbound_do_tcp else 'no' }}
    
    # Access control
    {% for acl in unbound_access_control %}
    access-control: {{ acl }}
    {% endfor %}
    
    # Performance tuning
    num-threads: {{ unbound_num_threads }}
    msg-cache-size: {{ unbound_msg_cache_size }}
    rrset-cache-size: {{ unbound_rrset_cache_size }}
    cache-min-ttl: {{ unbound_cache_min_ttl }}
    cache-max-ttl: {{ unbound_cache_max_ttl }}
    cache-max-negative-ttl: {{ unbound_cache_max_negative_ttl }}
    infra-cache-numhosts: {{ unbound_infra_cache_numhosts }}
    infra-cache-slabs: {{ unbound_infra_cache_slabs }}
    
    # Prefetching
    prefetch: {{ 'yes' if unbound_prefetch else 'no' }}
    prefetch-key: {{ 'yes' if unbound_prefetch_key else 'no' }}
    
    # DNSSEC
    module-config: "{{ unbound_module_config }}"
    auto-trust-anchor-file: "{{ unbound_auto_trust_anchor_file }}"
    val-clean-additional: {{ 'yes' if unbound_val_clean_additional else 'no' }}
    val-permissive-mode: {{ 'yes' if unbound_val_permissive_mode else 'no' }}
    ignore-cd-flag: {{ 'yes' if unbound_ignore_cd_flag else 'no' }}
    serve-expired: {{ 'yes' if unbound_serve_expired else 'no' }}
    
    # Privacy and security
    hide-identity: {{ 'yes' if unbound_hide_identity else 'no' }}
    hide-version: {{ 'yes' if unbound_hide_version else 'no' }}
    qname-minimisation: {{ 'yes' if unbound_qname_minimisation else 'no' }}
    qname-minimisation-strict: {{ 'yes' if unbound_qname_minimisation_strict else 'no' }}
    use-caps-for-id: {{ 'yes' if unbound_use_caps_for_id else 'no' }}
    
    # Private addresses
    {% for addr in unbound_private_addresses %}
    private-address: {{ addr }}
    {% endfor %}
    
    # Hardening options
    harden-glue: {{ 'yes' if unbound_harden_glue else 'no' }}
    harden-dnssec-stripped: {{ 'yes' if unbound_harden_dnssec_stripped else 'no' }}
    harden-below-nxdomain: {{ 'yes' if unbound_harden_below_nxdomain else 'no' }}
    harden-referral-path: {{ 'yes' if unbound_harden_referral_path else 'no' }}
    harden-algo-downgrade: {{ 'yes' if unbound_harden_algo_downgrade else 'no' }}
    
    # Logging
    verbosity: {{ unbound_verbosity }}
    use-syslog: {{ 'yes' if unbound_use_syslog else 'no' }}
    log-queries: {{ 'yes' if unbound_log_queries else 'no' }}
    log-replies: {{ 'yes' if unbound_log_replies else 'no' }}
    log-servfail: {{ 'yes' if unbound_log_servfail else 'no' }}
    
    # EDNS
    edns-buffer-size: {{ unbound_edns_buffer_size }}
    
    # Socket options
    so-reuseport: {{ 'yes' if unbound_so_reuseport else 'no' }}
    
    # Outgoing connections
    outgoing-range: {{ unbound_outgoing_range }}
    num-queries-per-thread: {{ unbound_num_queries_per_thread }}
    
    # Root hints
    root-hints: "{{ unbound_root_hints_file }}"
    
    # Local zones
    {% for zone in unbound_local_zones %}
    local-zone: "{{ zone.zone }}" {{ zone.type }}
    {% endfor %}
    
    # Local data
    {% for data in unbound_local_data %}
    local-data: "{{ data }}"
    {% endfor %}
    
    # Statistics
    statistics-interval: {{ unbound_statistics_interval }}
    statistics-cumulative: {{ 'yes' if unbound_statistics_cumulative else 'no' }}
    extended-statistics: {{ 'yes' if unbound_extended_statistics else 'no' }}

# Remote control
remote-control:
    control-enable: {{ 'yes' if unbound_remote_control_enable else 'no' }}
    {% if unbound_remote_control_enable %}
    control-interface: {{ unbound_control_interface }}
    control-port: {{ unbound_control_port }}
    {% endif %}

# Forward zones
{% for zone in unbound_forward_zones %}
forward-zone:
    name: "{{ zone.name }}"
    {% for addr in zone.forward_addr %}
    forward-addr: {{ addr }}
    {% endfor %}
{% endfor %}

# Stub zones
{% for zone in unbound_stub_zones %}
stub-zone:
    name: "{{ zone.name }}"
    {% for addr in zone.stub_addr %}
    stub-addr: {{ addr }}
    {% endfor %}
{% endfor %}